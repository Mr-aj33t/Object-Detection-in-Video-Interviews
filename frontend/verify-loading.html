<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Script Loading Verifier</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .status {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .loading {
            background: #fff3cd;
            color: #856404;
        }
        
        #log {
            font-family: monospace;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            height: 300px;
            overflow-y: auto;
        }
    </style>
</head>

<body>
    <h1> Script Loading Verifier</h1>
    <p>This page verifies that all required scripts load correctly.</p>

    <div id="status">
        <div id="tfjs-status" class="status loading">Checking TensorFlow.js...</div>
        <div id="coco-status" class="status loading">Checking COCO-SSD...</div>
        <div id="mediapipe-status" class="status loading">Checking MediaPipe...</div>
        <div id="detection-status" class="status loading">Checking Detection System...</div>
    </div>

    <h3>Console Log:</h3>
    <div id="log"></div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console[type === 'error' ? 'error' : 'log'](message);
        }

        function updateStatus(id, message, status) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = message;
                element.className = `status ${status}`;
            }
        }

        // Check if TensorFlow.js loaded
        function checkTensorFlow() {
            if (typeof tf !== 'undefined') {
                updateStatus('tfjs-status', ` TensorFlow.js v${tf.version.tfjs} loaded`, 'success');
                log('TensorFlow.js loaded successfully');
                return true;
            } else {
                updateStatus('tfjs-status', ' TensorFlow.js failed to load', 'error');
                log('Error: TensorFlow.js not loaded', 'error');
                return false;
            }
        }

        // Check if COCO-SSD loaded
        function checkCocoSSD() {
            if (typeof cocoSsd !== 'undefined') {
                updateStatus('coco-status', ' COCO-SSD loaded', 'success');
                log('COCO-SSD loaded successfully');
                return true;
            } else {
                updateStatus('coco-status', ' COCO-SSD failed to load', 'error');
                log('Error: COCO-SSD not loaded', 'error');
                return false;
            }
        }

        // Check if MediaPipe loaded
        function checkMediaPipe() {
            if (typeof FaceMesh !== 'undefined') {
                updateStatus('mediapipe-status', ' MediaPipe Face Mesh loaded', 'success');
                log('MediaPipe Face Mesh loaded successfully');
                return true;
            } else {
                updateStatus('mediapipe-status', ' MediaPipe Face Mesh failed to load', 'error');
                log('Error: MediaPipe Face Mesh not loaded', 'error');
                return false;
            }
        }

        // Check if DetectionSystem is available
        function checkDetectionSystem() {
            if (typeof window.DetectionSystem !== 'undefined') {
                updateStatus('detection-status', ' DetectionSystem loaded', 'success');
                log('DetectionSystem loaded successfully');
                return true;
            } else {
                updateStatus('detection-status', ' DetectionSystem not found', 'error');
                log('Error: DetectionSystem not defined', 'error');
                log('Check if detection.js is in the correct location and has no syntax errors', 'error');
                return false;
            }
        }

        function loadScript(src, onSuccess, onError) {
            const script = document.createElement('script');
            script.src = src;
            script.onload = onSuccess;
            script.onerror = () => onError(`Failed to load script: ${src}`);
            document.head.appendChild(script);
        }

        function initVerification() {
            log('Page loaded, starting verification...');

            // Check TensorFlow.js
            setTimeout(() => {
                const tfLoaded = checkTensorFlow();

                // Only check COCO-SSD if TensorFlow loaded
                if (tfLoaded) {
                    setTimeout(checkCocoSSD, 500);
                }

                // Check MediaPipe
                setTimeout(checkMediaPipe, 500);

                // Load detection.js
                loadScript(
                    'js/detection.js',
                    () => {
                        log('detection.js loaded successfully');
                        // Give it a moment to execute
                        setTimeout(() => {
                            const detectionLoaded = checkDetectionSystem();

                            if (detectionLoaded) {
                                log('\n All systems go! You can now use the DetectionSystem in your code.');
                                log('Example: const detector = new window.DetectionSystem();');
                            } else {
                                log('\n DetectionSystem not found after loading detection.js');
                                log('Checking window object for available properties...');

                                // Log all global properties that might be related
                                const globals = Object.keys(window).filter(k =>
                                    k.toLowerCase().includes('detect') ||
                                    k.toLowerCase().includes('face') ||
                                    k.toLowerCase().includes('ai')
                                );

                                if (globals.length > 0) {
                                    log('Found these potentially related globals: ' + globals.join(', '));
                                } else {
                                    log('No relevant globals found. The script may have failed to execute.');
                                }
                            }
                        }, 500);
                    },
                    (error) => {
                        log(` ${error}`, 'error');
                        updateStatus('detection-status', ' Failed to load detection.js', 'error');
                        log('Please check if the file exists at: js/detection.js');
                    }
                );

            }, 100);
        }

        // Start verification when the page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initVerification);
        } else {
            initVerification();
        }
    </script>

    <!-- Load all required scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2/dist/coco-ssd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection@0.0.3/dist/face-landmarks-detection.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh@0.4.1633559619/face_mesh.js"></script>
</body>

</html>
